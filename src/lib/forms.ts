// src/lib/forms.ts
import type { PartnerScope } from './types';

// ë¬¸í•­ íƒ€ì…
export type FormQuestion = { id: string; text: string };

// 0~5 ì ìˆ˜(0=ì „í˜€ ì•„ë‹˜, 5=ë§¤ìš° ê·¸ë ‡ë‹¤)
export const MAX_PER_ITEM = 5 as const;

// âœ… ê³µí†µ(êµ­ë‚´Â·í•´ì™¸ ê³µí†µ) â€” 15ë¬¸í•­
export const COMMON_QUESTIONS: FormQuestion[] = [
  // 1. ì´í•´ê´€ê³„ íˆ¬ëª…ì„±
  { id: 'c1a', text: 'ìƒëŒ€ì˜ ëª©ì ì´ ëª…í™•í•œê°€?' },
  { id: 'c1b', text: 'ìš°ë¦¬ê°€ ë¹ ì§€ë©´ í”„ë¡œì íŠ¸ê°€ ì§„í–‰ì´ ë¶ˆê°€ëŠ¥í•œê°€?' },
  { id: 'c1c', text: 'íŒŒíŠ¸ë„ˆëŠ” ìš°ë¦¬ë¥¼ ë™ë“±í•œ íŒŒíŠ¸ë„ˆë¡œ ì¸ì§€í•˜ëŠ”ê°€?' },

  // 2. ê¸°ì—¬ì™€ ê²°ê³¼ë¬¼ ê· í˜•
  { id: 'c2a', text: 'íˆ¬ì…(ëˆÂ·ì‹œê°„Â·ë…¸ë ¥)ê³¼ ìƒëŒ€ íˆ¬ì…ì´ ê· í˜•ì ì¸ê°€?' },
  { id: 'c2b', text: 'ì„±ê³¼ë¬¼ì— ìš°ë¦¬ì˜ ì´ë¦„ì´ ë‚¨ëŠ”ê°€?' },
  { id: 'c2c', text: 'ê²°ê³¼ê°€ ìƒí˜¸ ìœˆìœˆ êµ¬ì¡°ì¸ê°€?' },

  // 3. ë²•ì Â·ì œë„ì  ì¥ì¹˜
  { id: 'c3a', text: 'ê³„ì•½/MoUì— ê¶Œë¦¬Â·ì†Œìœ ê¶Œì´ ëª…ì‹œë¼ ìˆëŠ”ê°€?' },
  { id: 'c3b', text: 'ë¹„ìš©Â·ì´ìµ ë¶„ë°°ê°€ ì„œë©´ìœ¼ë¡œ í•©ì˜ë¼ ìˆëŠ”ê°€?' },
  { id: 'c3c', text: 'ì¤‘ë„ ì´íƒˆ ì‹œ ì±…ì„Â·ê¶Œë¦¬ê°€ ë¬¸ì„œì— ê·œì •ë¼ ìˆëŠ”ê°€?' },

  // 4. ì‹¤í–‰ë ¥ ê²€ì¦
  { id: 'c4a', text: 'ê³¼ê±° ì„±ê³¼Â·ë ˆí¼ëŸ°ìŠ¤ê°€ ìˆëŠ”ê°€?' },
  { id: 'c4b', text: 'ë„¤íŠ¸ì›Œí¬Â·ì˜í–¥ë ¥ì´ ì‹¤ì œ ê²€ì¦ ê°€ëŠ¥í•œê°€?' },
  { id: 'c4c', text: 'ëê¹Œì§€ ì‹¤í–‰í•  ëŠ¥ë ¥ì´ ìˆëŠ”ê°€?' },

  // 5. Exit ì „ëµ
  { id: 'c5a', text: 'í‹€ì–´ì ¸ë„ ìš°ë¦¬ê°€ ì±™ê¸¸ ìµœì†Œ ìì‚°ì´ ìˆëŠ”ê°€?' },
  { id: 'c5b', text: 'ì² ìˆ˜Â·ì¢…ë£Œ ì¡°í•­ì´ ê³„ì•½ì— í¬í•¨ë¼ ìˆëŠ”ê°€?' },
  { id: 'c5c', text: 'ì‹¤íŒ¨í•´ë„ ì–»ëŠ” ê²Œ ë‚¨ëŠ” êµ¬ì¡°ì¸ê°€?' },
];

// ğŸŒ í•´ì™¸ ë³´ê°• â€” 8ë¬¸í•­
export const OVERSEAS_QUESTIONS: FormQuestion[] = [
  // A. í˜„ì§€ ì œë„Â·ë²•ì  í™˜ê²½
  { id: 'oAa', text: 'í˜„ì§€ì—ì„œ ê³„ì•½ì´ ì‹¤ì œë¡œ ë²•ì  íš¨ë ¥ì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ”ê°€?' },
  { id: 'oAb', text: 'ì •ì¹˜/ì •ë¶€/ê¸°ê´€ê³¼ì˜ ê´€ê³„ê°€ ì•ˆì •ì ì¸ê°€?' },

  // B. ì–¸ì–´Â·ë¬¸í™” ì°¨ì´
  { id: 'oBa', text: 'ì¤‘ìš”í•œ í•©ì˜ëŠ” ë°˜ë“œì‹œ ì´ì¤‘ ì–¸ì–´ ë¬¸ì„œë¡œ ë‚¨ê¸°ëŠ”ê°€?' },
  { id: 'oBb', text: 'ë¬¸í™”ì  ì˜¤í•´ë¥¼ ì¤„ì´ê¸° ìœ„í•œ í˜„ì§€ ìë¬¸/ë¸Œë¡œì»¤ë¥¼ í™•ë³´í–ˆëŠ”ê°€?' },

  // C. ì‹¤í–‰ë ¥Â·ì§€ì†ì„±
  { id: 'oCa', text: 'íŒŒíŠ¸ë„ˆê°€ ì‹¤í–‰ ìê¸ˆì„ ì‹¤ì œë¡œ ë³´ìœ í•˜ê³  ìˆëŠ”ê°€?' },
  { id: 'oCb', text: 'ë‹¨ê¸° ì´ë²¤íŠ¸ìš©ì´ ì•„ë‹Œ ì§€ì† ê°€ëŠ¥í•œ êµ¬ì¡°ì¸ì§€ í™•ì¸í–ˆëŠ”ê°€?' },

  // D. Exit ì „ëµ(í•´ì™¸ íŠ¹í™”)
  { id: 'oDa', text: 'ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ëŒ€ì²´ íŒŒíŠ¸ë„ˆë¥¼ í™•ë³´í•  ìˆ˜ ìˆëŠ”ê°€?' },
  { id: 'oDb', text: 'í˜„ì§€ì— ë‚¨ê¸´ ìì‚°(ê¸°ìˆ Â·ë°ì´í„°Â·ì½˜í…ì¸ )ì„ íšŒìˆ˜ ê°€ëŠ¥í•œê°€?' },
];

// ì ìˆ˜ ë°°ì—´ì„ 0~100ìœ¼ë¡œ í™˜ì‚° (êµ­ë‚´=ê³µí†µë§Œ, í•´ì™¸=ê³µí†µ+í•´ì™¸)
export function toHundred(
  scope: PartnerScope,
  answersCommon: number[],
  answersOverseas?: number[]
): number {
  const usedCommon = answersCommon.slice(0, COMMON_QUESTIONS.length);
  const usedOverseas =
    scope === 'overseas' ? (answersOverseas ?? []).slice(0, OVERSEAS_QUESTIONS.length) : [];

  const sum = [...usedCommon, ...usedOverseas].reduce(
    (a, b) => a + (Number.isFinite(b) ? b : 0),
    0
  );

  const itemCount =
    scope === 'overseas'
      ? COMMON_QUESTIONS.length + OVERSEAS_QUESTIONS.length
      : COMMON_QUESTIONS.length;

  const max = itemCount * MAX_PER_ITEM;
  const pct = max === 0 ? 0 : (sum / max) * 100;
  // ì†Œìˆ˜ì  1ìë¦¬ ë°˜ì˜¬ë¦¼
  return Math.round(pct * 10) / 10;
}
